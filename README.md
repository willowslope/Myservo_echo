# MyServo_echo
## 概要
Wroom-02を使ったサーボコントローラーです。レシーバーの代わりに使い、プロポの代わりにスマホでコントロールできるようにすることを狙っています。同ネットワークのコントローラーを連動することもできます。MQTTサーバーに接続してAmazon Echoに反応して稼働するようにしました。
## インターフェイス
以下の2種を用意。
* HTML5で2軸(4CH)のプロポ模擬
* RCWController（スマホアプリ）に対応
* Amazon Echoに対応（CH2のサーボがON,OFFで動作)
## Wifi設定
自機がAPになるモードと他のAPに接続するSTモードをDIP-SWで切替。（切替判断は起動時のみ）
* APモード：ESP_(チップID) という名前のSSIDになる。
* STモード：後述のSSID設定で保存されたAPに自動接続
## AmazonEcho用設定
* ホームスキル作成
オリジナルのスキルを作成して後述のlambdaにつなげてください
* AWS lambda設定
MQTTサーバに接続するコードを記述します。lambdaフォルダ内のソースのように書いてください。ランタイムはPython2.7になります。ON,OFFにだけ対応しています。
* AWS EC2設定
MQTTサーバを立ててください。
## 設定の保存
リバース、動作域設定、STモード時のSSIDをEEPROMに保存。
## 使い方
1. DIP-SWを設定して電源ON
* SW1: AP/STモード設定
* SW2: 未使用
2. スマホのWiFi設定でアクセスポイントをESP_(ID名)又はコントローラーと同じSSIDに設定
3. スマホのブラウザでhttp://ESP_(ID名).local又はhttp://192.168.0.10(APモード時)を開く。RCWControllerの場合は IP:192.168.0.10(APモード時), PORT:10000 に接続
## 操作画面
### メインページ(http://ESP_(ID名).local  or http://192.168.0.10)
各CHのサーボを操作できます。ボリュームを操作するとSubmitボタンを押さなくてもサーボが動きます。
### プロポモード(http://(IPアドレス)/Propo)
黒丸を操作するとサーボが操作できます。縦持ち横持ちに対応しています。http://ESP_(ID名).local/Propoでもアクセスできますが、名前解決に時間がかかり滑らかに動きません。
左(or上)のx軸,y軸、右(or下)のx軸,y軸の順にCH1～4が割り当てられています。左上の矢印は戻るボタンです。
### 設定(http://ESP_(ID名).local/Setting
CH毎のサーボの可動域の制限、リバース、SSIDの設定ができます。また、BroadCastをONにすると同じネットワークの他のコントローラーが連動します。Submitボタンを押すと設定が保存されます。BroadCast以外は電源を切っても消えません。
